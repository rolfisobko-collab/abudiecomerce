(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6053],{4375:(e,t,r)=>{Promise.resolve().then(r.bind(r,401))},401:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var a=r(5155),o=r(6962),s=r(3805),c=r(5565),l=r(2115);let n=()=>{let{router:e}=(0,s.U)();return(0,l.useEffect)(()=>{setTimeout(()=>{e.push("/my-orders")},9e3)},[]),(0,a.jsxs)("div",{className:"h-screen flex flex-col justify-center items-center gap-5",children:[(0,a.jsxs)("div",{className:"flex justify-center items-center relative",children:[(0,a.jsx)(c.default,{className:"absolute p-5",src:o.mY.checkmark,alt:""}),(0,a.jsx)("div",{className:"animate-spin rounded-full h-24 w-24 border-4 border-t-green-300 border-gray-200"})]}),(0,a.jsx)("div",{className:"text-center text-2xl font-semibold",children:"Order Placed Successfully"})]})}},3805:(e,t,r)=>{"use strict";r.d(t,{AppContextProvider:()=>d,U:()=>u});var a=r(5155),o=r(2615),s=r(2651),c=r(6046),l=r(2115),n=r(5037);let i=(0,l.createContext)(),u=()=>(0,l.useContext)(i),d=e=>{let t=(0,c.useRouter)(),{data:r,status:u}=(0,o.useSession)(),d=null==r?void 0:r.user,g=async()=>{try{if(!r)return console.log("No hay sesi\xf3n activa"),null;return"authenticated"}catch(e){return console.error("Error getting token:",e),null}},[m,p]=(0,l.useState)([]),[f,y]=(0,l.useState)([]),[h,N]=(0,l.useState)(!1),[E,D]=(0,l.useState)(!1),[A,U]=(0,l.useState)({}),[O,S]=(0,l.useState)(!0),v=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{if(S(!0),!e){let e=localStorage.getItem("quickcart_products"),t=localStorage.getItem("quickcart_products_timestamp");if(e&&t&&Date.now()-parseInt(t)<6e5){console.log("\uD83D\uDCE6 Cargando productos desde localStorage"),p(JSON.parse(e)),S(!1),R();return}}await R()}catch(e){console.error("Error loading products:",e),n.Ay.error("Error al cargar productos"),S(!1)}},R=async()=>{try{console.log("\uD83C\uDF10 Cargando productos desde Atlas (API)");let{data:e}=await s.A.get("/api/product/list",{timeout:1e4});if(e.success){let t=e.products.map(e=>({...e,minQuantity:e.minWholesaleQuantity&&e.minWholesaleQuantity>0?e.minWholesaleQuantity:1,image:e.image&&e.image.length>0&&e.image[0]&&""!==e.image[0]?e.image:["/placeholder-product.jpeg"]}));p(t),setTimeout(()=>{localStorage.setItem("quickcart_products",JSON.stringify(t)),localStorage.setItem("quickcart_products_timestamp",Date.now().toString()),console.log("\uD83D\uDCBE Productos guardados en localStorage (Atlas)")},0)}else n.Ay.error(e.message)}catch(e){console.error("Error fetching products from Atlas API:",e),n.Ay.error("Error al cargar productos desde Atlas")}finally{S(!1)}},x=async()=>{try{let{data:e}=await s.A.get("/api/categories");e.success&&y(e.categories)}catch(e){console.error("Error fetching categories:",e)}},C=async()=>{try{if(console.log("\uD83D\uDD0D [FRONTEND DEBUG] Iniciando fetchUserData..."),console.log("\uD83D\uDD0D [FRONTEND DEBUG] Usuario de NextAuth:",d?{id:d.id,email:d.email,role:d.role}:"No hay usuario"),!d){console.log("❌ [FRONTEND DEBUG] No hay usuario autenticado");return}console.log("\uD83D\uDD0D [FRONTEND DEBUG] Haciendo petici\xf3n a /api/user/data...");let{data:e}=await s.A.get("/api/user/data");console.log("\uD83D\uDD0D [FRONTEND DEBUG] Respuesta del servidor:",e),e.success?(console.log("✅ [FRONTEND DEBUG] Usuario encontrado exitosamente en la base de datos"),N(e.user),U(e.user.cartItems)):(console.log("❌ [FRONTEND DEBUG] Error del servidor:",e.message),n.Ay.error(e.message))}catch(e){console.log("❌ [FRONTEND DEBUG] Error en fetchUserData:",e.message),console.log("\uD83D\uDD0D [FRONTEND DEBUG] Error completo:",e),n.Ay.error(e.message)}},_=async e=>{if(!d)return(0,n.Ay)("Please login",{icon:"⚠️"});let t=structuredClone(A);if(t[e]?t[e]+=1:t[e]=1,U(t),d)try{await s.A.post("/api/cart/update",{cartData:t}),n.Ay.success("Item added to cart")}catch(e){n.Ay.error(e.message)}},T=async(e,t)=>{let r=structuredClone(A);if(0===t?delete r[e]:r[e]=t,U(r),d)try{await s.A.post("/api/cart/update",{cartData:r}),n.Ay.success("Cart Updated")}catch(e){n.Ay.error(e.message)}};(0,l.useEffect)(()=>{v(),x()},[]),(0,l.useEffect)(()=>{console.log("\uD83D\uDD0D [FRONTEND DEBUG] useEffect ejecutado - usuario cambi\xf3:",d?{id:d.id,email:d.email,role:d.role}:"No hay usuario"),d?(console.log("\uD83D\uDD0D [FRONTEND DEBUG] Usuario detectado, llamando fetchUserData..."),C()):(console.log("\uD83D\uDD0D [FRONTEND DEBUG] No hay usuario, limpiando datos..."),N(!1),D(!1),U({}))},[d]);let w={user:d,signOut:o.signOut,getToken:g,currency:"$",router:t,isSeller:E,setIsSeller:D,userData:h,fetchUserData:C,products:m,fetchProductData:v,categories:f,fetchCategories:x,getCategoryName:e=>{if(!e||!f.length)return"Sin categor\xeda";let t=f.find(t=>t._id===e);return t?t.name:"Sin categor\xeda"},updateProductRating:(e,t,r)=>{p(a=>a.map(a=>a._id===e?{...a,averageRating:t,totalRatings:r}:a))},isLoadingProducts:O,cartItems:A,setCartItems:U,addToCart:_,updateCartQuantity:T,getCartCount:()=>{let e=0;for(let t in A)A[t]>0&&(e+=A[t]);return e},getCartAmount:()=>{let e=0;for(let t in A){let r=m.find(e=>e._id===t);if(A[t]>0&&r){let a=r.minQuantity&&r.minQuantity>0?r.minQuantity:1;e+=(A[t]>=a?r.offerPrice:r.price)*A[t]}}return Math.floor(100*e)/100},generateCartShareUrl:()=>{let e=Object.entries(A).filter(e=>{let[t,r]=e;return r>0});if(0===e.length)return null;let t=e.map(e=>{let[t,r]=e;return"".concat(t,":").concat(r)}).join(",");return"".concat(window.location.origin,"/cart?products=").concat(encodeURIComponent(t))}};return(0,a.jsx)(i.Provider,{value:w,children:e.children})}}},e=>{var t=t=>e(e.s=t);e.O(0,[5037,2651,3060,5565,6962,8441,1517,7358],()=>t(4375)),_N_E=e.O()}]);