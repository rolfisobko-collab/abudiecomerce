(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3055],{9313:(e,t,r)=>{Promise.resolve().then(r.bind(r,1788))},1788:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var a=r(5155);r(2115),r(6962);var o=r(5565),s=r(3805),n=r(6046),c=r(5037);let l=()=>{let{router:e}=(0,s.U)(),t=(0,n.useRouter)(),r=async()=>{try{console.log("\uD83D\uDD0D [ADMIN LOGOUT DEBUG] Cerrando sesi\xf3n de admin...");let e=await fetch("/api/admin/logout",{method:"POST"}),r=await e.json();console.log("\uD83D\uDD0D [ADMIN LOGOUT DEBUG] Respuesta:",r),r.success?(c.Ay.success("Sesi\xf3n cerrada exitosamente"),t.push("/")):c.Ay.error("Error al cerrar sesi\xf3n")}catch(e){console.log("❌ [ADMIN LOGOUT DEBUG] Error:",e),c.Ay.error("Error al cerrar sesi\xf3n")}};return(0,a.jsxs)("div",{className:"flex items-center px-4 md:px-8 py-3 justify-between border-b bg-black",children:[(0,a.jsx)(o.default,{onClick:()=>e.push("/"),className:"w-28 lg:w-32 cursor-pointer",src:"/abudilogo2.png",alt:"",width:128,height:128}),(0,a.jsx)("button",{onClick:r,className:"bg-gray-600 text-white px-5 py-2 sm:px-7 sm:py-2 rounded-full text-xs sm:text-sm hover:bg-gray-700",children:"Logout Admin"})]})};var i=r(8173),u=r.n(i),d=r(648);let g=()=>{let e=(0,n.usePathname)(),t=[{name:"Add Product",path:"/seller",icon:d.jgn},{name:"Product List",path:"/seller/product-list",icon:d.YBc},{name:"Categories",path:"/seller/categories",icon:d.M1j},{name:"Brands",path:"/seller/brands",icon:d.BNs},{name:"Orders",path:"/seller/orders",icon:d.F6S},{name:"Payment Methods",path:"/seller/payment-methods",icon:d.OrL},{name:"Communications",path:"/seller/communications",icon:d.mm2},{name:"Admin Users",path:"/seller/admin-users",icon:d.g_8}];return(0,a.jsx)("div",{className:"md:w-64 w-16 border-r min-h-screen text-base border-gray-300 py-2 flex flex-col",children:t.map(t=>{let r=e===t.path;return(0,a.jsx)(u(),{href:t.path,passHref:!0,children:(0,a.jsxs)("div",{className:"flex items-center py-3 px-4 gap-3 ".concat(r?"border-r-4 md:border-r-[6px] bg-[#feecaf]/10 border-[#feecaf]":"hover:bg-gray-100/90 border-white"),children:[(0,a.jsx)(t.icon,{className:"w-7 h-7 text-gray-700"}),(0,a.jsx)("p",{className:"md:block hidden text-center",children:t.name})]})},t.name)})})},m=e=>{let{children:t}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)(l,{}),(0,a.jsxs)("div",{className:"flex w-full",children:[(0,a.jsx)(g,{}),t]})]})}},3805:(e,t,r)=>{"use strict";r.d(t,{AppContextProvider:()=>d,U:()=>u});var a=r(5155),o=r(2615),s=r(2651),n=r(6046),c=r(2115),l=r(5037);let i=(0,c.createContext)(),u=()=>(0,c.useContext)(i),d=e=>{let t=(0,n.useRouter)(),{data:r,status:u}=(0,o.useSession)(),d=null==r?void 0:r.user,g=async()=>{try{if(!r)return console.log("No hay sesi\xf3n activa"),null;return"authenticated"}catch(e){return console.error("Error getting token:",e),null}},[m,p]=(0,c.useState)([]),[h,y]=(0,c.useState)([]),[f,N]=(0,c.useState)(!1),[E,x]=(0,c.useState)(!1),[D,A]=(0,c.useState)({}),[U,O]=(0,c.useState)(!0),b=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{if(O(!0),!e){let e=localStorage.getItem("quickcart_products"),t=localStorage.getItem("quickcart_products_timestamp");if(e&&t&&Date.now()-parseInt(t)<6e5){console.log("\uD83D\uDCE6 Cargando productos desde localStorage"),p(JSON.parse(e)),O(!1),w();return}}await w()}catch(e){console.error("Error loading products:",e),l.Ay.error("Error al cargar productos"),O(!1)}},w=async()=>{try{console.log("\uD83C\uDF10 Cargando productos desde Atlas (API)");let{data:e}=await s.A.get("/api/product/list",{timeout:1e4});if(e.success){let t=e.products.map(e=>({...e,minQuantity:e.minWholesaleQuantity&&e.minWholesaleQuantity>0?e.minWholesaleQuantity:1,image:e.image&&e.image.length>0&&e.image[0]&&""!==e.image[0]?e.image:["/placeholder-product.jpeg"]}));p(t),setTimeout(()=>{localStorage.setItem("quickcart_products",JSON.stringify(t)),localStorage.setItem("quickcart_products_timestamp",Date.now().toString()),console.log("\uD83D\uDCBE Productos guardados en localStorage (Atlas)")},0)}else l.Ay.error(e.message)}catch(e){console.error("Error fetching products from Atlas API:",e),l.Ay.error("Error al cargar productos desde Atlas")}finally{O(!1)}},v=async()=>{try{let{data:e}=await s.A.get("/api/categories");e.success&&y(e.categories)}catch(e){console.error("Error fetching categories:",e)}},S=async()=>{try{if(console.log("\uD83D\uDD0D [FRONTEND DEBUG] Iniciando fetchUserData..."),console.log("\uD83D\uDD0D [FRONTEND DEBUG] Usuario de NextAuth:",d?{id:d.id,email:d.email,role:d.role}:"No hay usuario"),!d){console.log("❌ [FRONTEND DEBUG] No hay usuario autenticado");return}console.log("\uD83D\uDD0D [FRONTEND DEBUG] Haciendo petici\xf3n a /api/user/data...");let{data:e}=await s.A.get("/api/user/data");console.log("\uD83D\uDD0D [FRONTEND DEBUG] Respuesta del servidor:",e),e.success?(console.log("✅ [FRONTEND DEBUG] Usuario encontrado exitosamente en la base de datos"),N(e.user),A(e.user.cartItems)):(console.log("❌ [FRONTEND DEBUG] Error del servidor:",e.message),l.Ay.error(e.message))}catch(e){console.log("❌ [FRONTEND DEBUG] Error en fetchUserData:",e.message),console.log("\uD83D\uDD0D [FRONTEND DEBUG] Error completo:",e),l.Ay.error(e.message)}},j=async e=>{if(!d)return(0,l.Ay)("Please login",{icon:"⚠️"});let t=structuredClone(D);if(t[e]?t[e]+=1:t[e]=1,A(t),d)try{await s.A.post("/api/cart/update",{cartData:t}),l.Ay.success("Item added to cart")}catch(e){l.Ay.error(e.message)}},C=async(e,t)=>{let r=structuredClone(D);if(0===t?delete r[e]:r[e]=t,A(r),d)try{await s.A.post("/api/cart/update",{cartData:r}),l.Ay.success("Cart Updated")}catch(e){l.Ay.error(e.message)}};(0,c.useEffect)(()=>{b(),v()},[]),(0,c.useEffect)(()=>{console.log("\uD83D\uDD0D [FRONTEND DEBUG] useEffect ejecutado - usuario cambi\xf3:",d?{id:d.id,email:d.email,role:d.role}:"No hay usuario"),d?(console.log("\uD83D\uDD0D [FRONTEND DEBUG] Usuario detectado, llamando fetchUserData..."),S()):(console.log("\uD83D\uDD0D [FRONTEND DEBUG] No hay usuario, limpiando datos..."),N(!1),x(!1),A({}))},[d]);let R={user:d,signOut:o.signOut,getToken:g,currency:"$",router:t,isSeller:E,setIsSeller:x,userData:f,fetchUserData:S,products:m,fetchProductData:b,categories:h,fetchCategories:v,getCategoryName:e=>{if(!e||!h.length)return"Sin categor\xeda";let t=h.find(t=>t._id===e);return t?t.name:"Sin categor\xeda"},updateProductRating:(e,t,r)=>{p(a=>a.map(a=>a._id===e?{...a,averageRating:t,totalRatings:r}:a))},isLoadingProducts:U,cartItems:D,setCartItems:A,addToCart:j,updateCartQuantity:C,getCartCount:()=>{let e=0;for(let t in D)D[t]>0&&(e+=D[t]);return e},getCartAmount:()=>{let e=0;for(let t in D){let r=m.find(e=>e._id===t);if(D[t]>0&&r){let a=r.minQuantity&&r.minQuantity>0?r.minQuantity:1;e+=(D[t]>=a?r.offerPrice:r.price)*D[t]}}return Math.floor(100*e)/100},generateCartShareUrl:()=>{let e=Object.entries(D).filter(e=>{let[t,r]=e;return r>0});if(0===e.length)return null;let t=e.map(e=>{let[t,r]=e;return"".concat(t,":").concat(r)}).join(",");return"".concat(window.location.origin,"/cart?products=").concat(encodeURIComponent(t))}};return(0,a.jsx)(i.Provider,{value:R,children:e.children})}}},e=>{var t=t=>e(e.s=t);e.O(0,[5479,5037,2651,3060,5565,8007,6962,8441,1517,7358],()=>t(9313)),_N_E=e.O()}]);