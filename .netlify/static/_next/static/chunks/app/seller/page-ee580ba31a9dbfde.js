(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8252],{6528:(e,a,t)=>{Promise.resolve().then(t.bind(t,4780))},4780:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>i});var r=t(5155),o=t(2115),s=t(6962),l=t(5565);t(3805);var n=t(2651),c=t(5037);let i=()=>{let[e,a]=(0,o.useState)([]),[t,i]=(0,o.useState)(""),[d,u]=(0,o.useState)(""),[m,p]=(0,o.useState)(""),[g,h]=(0,o.useState)(""),[y,x]=(0,o.useState)(""),[f,N]=(0,o.useState)(""),[b,v]=(0,o.useState)(""),[j,E]=(0,o.useState)([]),[D,w]=(0,o.useState)([]),S=async()=>{try{let{data:e}=await n.A.get("/api/categories");e.success&&(E(e.categories),e.categories.length>0&&!m&&p(e.categories[0]._id))}catch(e){console.log("Error al cargar categor\xedas:",e)}},A=async()=>{try{let{data:e}=await n.A.get("/api/brands");e.success&&(w(e.brands),e.brands.length>0&&!g&&h(e.brands[0]._id))}catch(e){console.log("Error al cargar marcas:",e)}};(0,o.useEffect)(()=>{S(),A()},[]);let C=async r=>{r.preventDefault();let o=new FormData;o.append("name",t),o.append("description",d),o.append("category",m),o.append("brand",g),o.append("price",y),o.append("offerPrice",f),o.append("minWholesaleQuantity",b);for(let a=0;a<e.length;a++)o.append("images",e[a]);try{let{data:e}=await n.A.post("/api/product/add",o);e.success?(c.Ay.success(e.message),a([]),i(""),u(""),p(j.length>0?j[0]._id:""),h(D.length>0?D[0]._id:""),x(""),N(""),v("")):c.Ay.error(e.message)}catch(e){c.Ay.error(e.message)}};return(0,r.jsx)("div",{className:"flex-1 min-h-screen flex flex-col justify-between",children:(0,r.jsxs)("form",{onSubmit:C,className:"md:p-10 p-4 space-y-5 max-w-lg",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-base font-medium",children:["Product Image ",(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"(opcional)"})]}),(0,r.jsx)("div",{className:"flex flex-wrap items-center gap-3 mt-2",children:[void 0,void 0,void 0,void 0].map((t,o)=>(0,r.jsxs)("label",{htmlFor:"image".concat(o),children:[(0,r.jsx)("input",{onChange:t=>{let r=[...e];r[o]=t.target.files[0],a(r)},type:"file",id:"image".concat(o),hidden:!0}),(0,r.jsx)(l.default,{className:"max-w-24 cursor-pointer",src:e[o]?URL.createObjectURL(e[o]):s.mY.upload_area,alt:"",width:100,height:100},o)]},o))})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1 max-w-md",children:[(0,r.jsx)("label",{className:"text-base font-medium",htmlFor:"product-name",children:"Product Name"}),(0,r.jsx)("input",{id:"product-name",type:"text",placeholder:"Type here",className:"outline-none md:py-2.5 py-2 px-3 rounded border border-gray-500/40",onChange:e=>i(e.target.value),value:t,required:!0})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1 max-w-md",children:[(0,r.jsx)("label",{className:"text-base font-medium",htmlFor:"product-description",children:"Product Description"}),(0,r.jsx)("textarea",{id:"product-description",rows:4,className:"outline-none md:py-2.5 py-2 px-3 rounded border border-gray-500/40 resize-none",placeholder:"Type here",onChange:e=>u(e.target.value),value:d,required:!0})]}),(0,r.jsxs)("div",{className:"flex items-center gap-5 flex-wrap",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1 w-32",children:[(0,r.jsx)("label",{className:"text-base font-medium",htmlFor:"category",children:"Category"}),(0,r.jsxs)("select",{id:"category",className:"outline-none md:py-2.5 py-2 px-3 rounded border border-gray-500/40",onChange:e=>p(e.target.value),value:m,children:[(0,r.jsx)("option",{value:"",children:"Seleccionar categor\xeda"}),j.map(e=>(0,r.jsx)("option",{value:e._id,children:e.name},e._id))]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1 w-32",children:[(0,r.jsx)("label",{className:"text-base font-medium",htmlFor:"brand",children:"Marca"}),(0,r.jsxs)("select",{id:"brand",className:"outline-none md:py-2.5 py-2 px-3 rounded border border-gray-500/40",onChange:e=>h(e.target.value),value:g,children:[(0,r.jsx)("option",{value:"",children:"Seleccionar marca"}),D.map(e=>(0,r.jsx)("option",{value:e._id,children:e.name},e._id))]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1 w-32",children:[(0,r.jsx)("label",{className:"text-base font-medium",htmlFor:"product-price",children:"Product Price"}),(0,r.jsx)("input",{id:"product-price",type:"number",placeholder:"0",className:"outline-none md:py-2.5 py-2 px-3 rounded border border-gray-500/40",onChange:e=>x(e.target.value),value:y,required:!0})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1 w-32",children:[(0,r.jsx)("label",{className:"text-base font-medium",htmlFor:"offer-price",children:"Offer Price"}),(0,r.jsx)("input",{id:"offer-price",type:"number",placeholder:"0",className:"outline-none md:py-2.5 py-2 px-3 rounded border border-gray-500/40",onChange:e=>N(e.target.value),value:f,required:!0})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1 w-32",children:[(0,r.jsx)("label",{className:"text-base font-medium",htmlFor:"min-wholesale-quantity",children:"Cantidad M\xednima para Precio Mayorista"}),(0,r.jsx)("input",{id:"min-wholesale-quantity",type:"number",placeholder:"1",min:"1",className:"outline-none md:py-2.5 py-2 px-3 rounded border border-gray-500/40",onChange:e=>v(e.target.value),value:b,required:!0})]})]}),(0,r.jsx)("button",{type:"submit",className:"px-8 py-2.5 bg-[#feecaf] text-black font-medium rounded",children:"ADD"})]})})}},3805:(e,a,t)=>{"use strict";t.d(a,{AppContextProvider:()=>u,U:()=>d});var r=t(5155),o=t(2615),s=t(2651),l=t(6046),n=t(2115),c=t(5037);let i=(0,n.createContext)(),d=()=>(0,n.useContext)(i),u=e=>{let a=(0,l.useRouter)(),{data:t,status:d}=(0,o.useSession)(),u=null==t?void 0:t.user,m=async()=>{try{if(!t)return console.log("No hay sesi\xf3n activa"),null;return"authenticated"}catch(e){return console.error("Error getting token:",e),null}},[p,g]=(0,n.useState)([]),[h,y]=(0,n.useState)([]),[x,f]=(0,n.useState)(!1),[N,b]=(0,n.useState)(!1),[v,j]=(0,n.useState)({}),[E,D]=(0,n.useState)(!0),w=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{if(D(!0),!e){let e=localStorage.getItem("quickcart_products"),a=localStorage.getItem("quickcart_products_timestamp");if(e&&a&&Date.now()-parseInt(a)<6e5){console.log("\uD83D\uDCE6 Cargando productos desde localStorage"),g(JSON.parse(e)),D(!1),S();return}}await S()}catch(e){console.error("Error loading products:",e),c.Ay.error("Error al cargar productos"),D(!1)}},S=async()=>{try{console.log("\uD83C\uDF10 Cargando productos desde Atlas (API)");let{data:e}=await s.A.get("/api/product/list",{timeout:1e4});if(e.success){let a=e.products.map(e=>({...e,minQuantity:e.minWholesaleQuantity&&e.minWholesaleQuantity>0?e.minWholesaleQuantity:1,image:e.image&&e.image.length>0&&e.image[0]&&""!==e.image[0]?e.image:["/placeholder-product.jpeg"]}));g(a),setTimeout(()=>{localStorage.setItem("quickcart_products",JSON.stringify(a)),localStorage.setItem("quickcart_products_timestamp",Date.now().toString()),console.log("\uD83D\uDCBE Productos guardados en localStorage (Atlas)")},0)}else c.Ay.error(e.message)}catch(e){console.error("Error fetching products from Atlas API:",e),c.Ay.error("Error al cargar productos desde Atlas")}finally{D(!1)}},A=async()=>{try{let{data:e}=await s.A.get("/api/categories");e.success&&y(e.categories)}catch(e){console.error("Error fetching categories:",e)}},C=async()=>{try{if(console.log("\uD83D\uDD0D [FRONTEND DEBUG] Iniciando fetchUserData..."),console.log("\uD83D\uDD0D [FRONTEND DEBUG] Usuario de NextAuth:",u?{id:u.id,email:u.email,role:u.role}:"No hay usuario"),!u){console.log("❌ [FRONTEND DEBUG] No hay usuario autenticado");return}console.log("\uD83D\uDD0D [FRONTEND DEBUG] Haciendo petici\xf3n a /api/user/data...");let{data:e}=await s.A.get("/api/user/data");console.log("\uD83D\uDD0D [FRONTEND DEBUG] Respuesta del servidor:",e),e.success?(console.log("✅ [FRONTEND DEBUG] Usuario encontrado exitosamente en la base de datos"),f(e.user),j(e.user.cartItems)):(console.log("❌ [FRONTEND DEBUG] Error del servidor:",e.message),c.Ay.error(e.message))}catch(e){console.log("❌ [FRONTEND DEBUG] Error en fetchUserData:",e.message),console.log("\uD83D\uDD0D [FRONTEND DEBUG] Error completo:",e),c.Ay.error(e.message)}},U=async e=>{if(!u)return(0,c.Ay)("Please login",{icon:"⚠️"});let a=structuredClone(v);if(a[e]?a[e]+=1:a[e]=1,j(a),u)try{await s.A.post("/api/cart/update",{cartData:a}),c.Ay.success("Item added to cart")}catch(e){c.Ay.error(e.message)}},_=async(e,a)=>{let t=structuredClone(v);if(0===a?delete t[e]:t[e]=a,j(t),u)try{await s.A.post("/api/cart/update",{cartData:t}),c.Ay.success("Cart Updated")}catch(e){c.Ay.error(e.message)}};(0,n.useEffect)(()=>{w(),A()},[]),(0,n.useEffect)(()=>{console.log("\uD83D\uDD0D [FRONTEND DEBUG] useEffect ejecutado - usuario cambi\xf3:",u?{id:u.id,email:u.email,role:u.role}:"No hay usuario"),u?(console.log("\uD83D\uDD0D [FRONTEND DEBUG] Usuario detectado, llamando fetchUserData..."),C()):(console.log("\uD83D\uDD0D [FRONTEND DEBUG] No hay usuario, limpiando datos..."),f(!1),b(!1),j({}))},[u]);let F={user:u,signOut:o.signOut,getToken:m,currency:"$",router:a,isSeller:N,setIsSeller:b,userData:x,fetchUserData:C,products:p,fetchProductData:w,categories:h,fetchCategories:A,getCategoryName:e=>{if(!e||!h.length)return"Sin categor\xeda";let a=h.find(a=>a._id===e);return a?a.name:"Sin categor\xeda"},updateProductRating:(e,a,t)=>{g(r=>r.map(r=>r._id===e?{...r,averageRating:a,totalRatings:t}:r))},isLoadingProducts:E,cartItems:v,setCartItems:j,addToCart:U,updateCartQuantity:_,getCartCount:()=>{let e=0;for(let a in v)v[a]>0&&(e+=v[a]);return e},getCartAmount:()=>{let e=0;for(let a in v){let t=p.find(e=>e._id===a);if(v[a]>0&&t){let r=t.minQuantity&&t.minQuantity>0?t.minQuantity:1;e+=(v[a]>=r?t.offerPrice:t.price)*v[a]}}return Math.floor(100*e)/100},generateCartShareUrl:()=>{let e=Object.entries(v).filter(e=>{let[a,t]=e;return t>0});if(0===e.length)return null;let a=e.map(e=>{let[a,t]=e;return"".concat(a,":").concat(t)}).join(",");return"".concat(window.location.origin,"/cart?products=").concat(encodeURIComponent(a))}};return(0,r.jsx)(i.Provider,{value:F,children:e.children})}}},e=>{var a=a=>e(e.s=a);e.O(0,[5037,2651,3060,5565,6962,8441,1517,7358],()=>a(6528)),_N_E=e.O()}]);