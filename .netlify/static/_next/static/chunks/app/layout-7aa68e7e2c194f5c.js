(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{1312:(e,t,r)=>{Promise.resolve().then(r.bind(r,6932)),Promise.resolve().then(r.bind(r,3805)),Promise.resolve().then(r.t.bind(r,7869,23)),Promise.resolve().then(r.t.bind(r,9324,23)),Promise.resolve().then(r.bind(r,5037))},6932:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var o=r(5155),a=r(2615);function s(e){let{children:t}=e;return(0,o.jsx)(a.SessionProvider,{children:t})}},3805:(e,t,r)=>{"use strict";r.d(t,{AppContextProvider:()=>d,U:()=>u});var o=r(5155),a=r(2615),s=r(2651),n=r(6046),l=r(2115),i=r(5037);let c=(0,l.createContext)(),u=()=>(0,l.useContext)(c),d=e=>{let t=(0,n.useRouter)(),{data:r,status:u}=(0,a.useSession)(),d=null==r?void 0:r.user,g=async()=>{try{if(!r)return console.log("No hay sesi\xf3n activa"),null;return"authenticated"}catch(e){return console.error("Error getting token:",e),null}},[m,p]=(0,l.useState)([]),[f,y]=(0,l.useState)([]),[h,E]=(0,l.useState)(!1),[N,D]=(0,l.useState)(!1),[A,U]=(0,l.useState)({}),[O,S]=(0,l.useState)(!0),v=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{if(S(!0),!e){let e=localStorage.getItem("quickcart_products"),t=localStorage.getItem("quickcart_products_timestamp");if(e&&t&&Date.now()-parseInt(t)<6e5){console.log("\uD83D\uDCE6 Cargando productos desde localStorage"),p(JSON.parse(e)),S(!1),R();return}}await R()}catch(e){console.error("Error loading products:",e),i.Ay.error("Error al cargar productos"),S(!1)}},R=async()=>{try{console.log("\uD83C\uDF10 Cargando productos desde Atlas (API)");let{data:e}=await s.A.get("/api/product/list",{timeout:1e4});if(e.success){let t=e.products.map(e=>({...e,minQuantity:e.minWholesaleQuantity&&e.minWholesaleQuantity>0?e.minWholesaleQuantity:1,image:e.image&&e.image.length>0&&e.image[0]&&""!==e.image[0]?e.image:["/placeholder-product.jpeg"]}));p(t),setTimeout(()=>{localStorage.setItem("quickcart_products",JSON.stringify(t)),localStorage.setItem("quickcart_products_timestamp",Date.now().toString()),console.log("\uD83D\uDCBE Productos guardados en localStorage (Atlas)")},0)}else i.Ay.error(e.message)}catch(e){console.error("Error fetching products from Atlas API:",e),i.Ay.error("Error al cargar productos desde Atlas")}finally{S(!1)}},_=async()=>{try{let{data:e}=await s.A.get("/api/categories");e.success&&y(e.categories)}catch(e){console.error("Error fetching categories:",e)}},C=async()=>{try{if(console.log("\uD83D\uDD0D [FRONTEND DEBUG] Iniciando fetchUserData..."),console.log("\uD83D\uDD0D [FRONTEND DEBUG] Usuario de NextAuth:",d?{id:d.id,email:d.email,role:d.role}:"No hay usuario"),!d){console.log("❌ [FRONTEND DEBUG] No hay usuario autenticado");return}console.log("\uD83D\uDD0D [FRONTEND DEBUG] Haciendo petici\xf3n a /api/user/data...");let{data:e}=await s.A.get("/api/user/data");console.log("\uD83D\uDD0D [FRONTEND DEBUG] Respuesta del servidor:",e),e.success?(console.log("✅ [FRONTEND DEBUG] Usuario encontrado exitosamente en la base de datos"),E(e.user),U(e.user.cartItems)):(console.log("❌ [FRONTEND DEBUG] Error del servidor:",e.message),i.Ay.error(e.message))}catch(e){console.log("❌ [FRONTEND DEBUG] Error en fetchUserData:",e.message),console.log("\uD83D\uDD0D [FRONTEND DEBUG] Error completo:",e),i.Ay.error(e.message)}},F=async e=>{if(!d)return(0,i.Ay)("Please login",{icon:"⚠️"});let t=structuredClone(A);if(t[e]?t[e]+=1:t[e]=1,U(t),d)try{await s.A.post("/api/cart/update",{cartData:t}),i.Ay.success("Item added to cart")}catch(e){i.Ay.error(e.message)}},P=async(e,t)=>{let r=structuredClone(A);if(0===t?delete r[e]:r[e]=t,U(r),d)try{await s.A.post("/api/cart/update",{cartData:r}),i.Ay.success("Cart Updated")}catch(e){i.Ay.error(e.message)}};(0,l.useEffect)(()=>{v(),_()},[]),(0,l.useEffect)(()=>{console.log("\uD83D\uDD0D [FRONTEND DEBUG] useEffect ejecutado - usuario cambi\xf3:",d?{id:d.id,email:d.email,role:d.role}:"No hay usuario"),d?(console.log("\uD83D\uDD0D [FRONTEND DEBUG] Usuario detectado, llamando fetchUserData..."),C()):(console.log("\uD83D\uDD0D [FRONTEND DEBUG] No hay usuario, limpiando datos..."),E(!1),D(!1),U({}))},[d]);let T={user:d,signOut:a.signOut,getToken:g,currency:"$",router:t,isSeller:N,setIsSeller:D,userData:h,fetchUserData:C,products:m,fetchProductData:v,categories:f,fetchCategories:_,getCategoryName:e=>{if(!e||!f.length)return"Sin categor\xeda";let t=f.find(t=>t._id===e);return t?t.name:"Sin categor\xeda"},updateProductRating:(e,t,r)=>{p(o=>o.map(o=>o._id===e?{...o,averageRating:t,totalRatings:r}:o))},isLoadingProducts:O,cartItems:A,setCartItems:U,addToCart:F,updateCartQuantity:P,getCartCount:()=>{let e=0;for(let t in A)A[t]>0&&(e+=A[t]);return e},getCartAmount:()=>{let e=0;for(let t in A){let r=m.find(e=>e._id===t);if(A[t]>0&&r){let o=r.minQuantity&&r.minQuantity>0?r.minQuantity:1;e+=(A[t]>=o?r.offerPrice:r.price)*A[t]}}return Math.floor(100*e)/100},generateCartShareUrl:()=>{let e=Object.entries(A).filter(e=>{let[t,r]=e;return r>0});if(0===e.length)return null;let t=e.map(e=>{let[t,r]=e;return"".concat(t,":").concat(r)}).join(",");return"".concat(window.location.origin,"/cart?products=").concat(encodeURIComponent(t))}};return(0,o.jsx)(c.Provider,{value:T,children:e.children})}},9324:()=>{},7869:e=>{e.exports={style:{fontFamily:"'Outfit', 'Outfit Fallback'",fontStyle:"normal"},className:"__className_1357df"}}},e=>{var t=t=>e(e.s=t);e.O(0,[2900,5037,2651,3060,8441,1517,7358],()=>t(1312)),_N_E=e.O()}]);